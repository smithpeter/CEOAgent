# ADR-002: 向量数据库选择 - Weaviate

## 状态
已接受

## 上下文

CEOAgent 需要向量数据库来支持：
- RAG（检索增强生成）：存储文档嵌入向量
- 语义检索：根据查询向量检索相似内容
- 长期记忆：存储历史决策的向量表示
- 知识库：管理领域知识的向量索引

需要选择向量数据库，候选方案：
1. **Pinecone**：托管服务，易于使用
2. **Weaviate**：开源，自托管
3. **Milvus**：开源，高性能
4. **Qdrant**：开源，Rust 实现
5. **PGVector**：PostgreSQL 扩展

## 决策

我们决定使用 **Weaviate**。

## 理由

### 1. 开源和自托管
- **无供应商锁定**：数据完全可控
- **成本可控**：无需支付托管费用
- **定制化**：可以根据需求定制和扩展

### 2. 混合搜索能力
- **向量搜索**：支持高维向量相似度搜索
- **关键词搜索**：支持 BM25 关键词搜索
- **混合搜索**：可以结合向量和关键词，效果更好

### 3. GraphQL API
- **灵活查询**：GraphQL 提供灵活的查询接口
- **类型安全**：强类型的查询语言
- **易于集成**：与现代前端框架集成良好

### 4. 特性丰富
- **元数据过滤**：支持复杂的元数据查询
- **分类器**：内置分类器支持
- **实时索引**：支持实时数据索引
- **多租户**：支持多租户数据隔离

### 5. 社区和文档
- **活跃社区**：开源项目，社区活跃
- **文档完善**：文档详细，易于上手
- **持续更新**：项目持续维护和更新

### 为什么不选择其他方案？

**Pinecone**：
- 托管服务，成本较高
- 供应商锁定
- 自定义能力有限

**Milvus**：
- 配置复杂
- 资源消耗较高
- 主要面向大规模场景（可能过度设计）

**PGVector**：
- 性能不如专门的向量数据库
- 扩展性有限
- 缺少高级特性（混合搜索等）

## 后果

### 积极影响

1. **数据控制**：完全控制数据，符合企业安全要求
2. **成本效益**：开源免费，节省托管成本
3. **灵活查询**：混合搜索提升检索质量
4. **易于运维**：可以 Docker 部署，运维简单

### 消极影响

1. **自托管成本**：需要自己维护基础设施
2. **学习曲线**：团队需要学习 Weaviate
3. **扩展性**：大规模场景可能需要集群配置

### 缓解措施

- 使用 Docker Compose 简化部署
- 提供详细的运维文档
- 监控和维护脚本
- 未来可以迁移到 Weaviate Cloud（如需要）

## 替代方案

如果未来需要更高性能或托管服务，可以考虑：
- 迁移到 Milvus（大规模场景）
- 使用 Pinecone（需要托管服务时）

## 参考

- [Weaviate 文档](https://weaviate.io/developers/weaviate)
- [ARCHITECTURE.md](../ARCHITECTURE.md)
