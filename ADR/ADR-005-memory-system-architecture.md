# ADR-005: Memory 系统架构

## 状态
已接受

## 上下文

AI Agent 需要记忆系统来：
- 维护对话上下文
- 存储历史决策和学习
- 管理领域知识
- 支持长期学习和优化

需要考虑如何设计多层次的记忆系统。

## 决策

我们决定实现**四层 Memory 架构**：
1. **短期记忆（Short-term Memory）**：对话上下文
2. **工作记忆（Working Memory）**：当前任务状态
3. **长期记忆（Long-term Memory）**：历史决策记录
4. **语义记忆（Semantic Memory）**：领域知识图谱

## 理由

### 1. 模拟人类记忆系统

人类记忆系统分为：
- **短期记忆**：当前的感知和思考
- **工作记忆**：正在处理的信息
- **长期记忆**：过去的经验和知识
- **语义记忆**：概念和关系知识

我们的设计模拟了这个结构。

### 2. 不同时间尺度

- **短期记忆**：秒到分钟（会话级别）
- **工作记忆**：分钟到小时（任务级别）
- **长期记忆**：持久化存储（历史记录）
- **语义记忆**：持久化存储（知识库）

### 3. 存储策略

- **短期记忆 + 工作记忆**：Redis（快速访问，TTL）
- **长期记忆**：PostgreSQL + Weaviate（结构化 + 向量）
- **语义记忆**：Neo4j（图数据库）

## 后果

### 积极影响

1. **层次清晰**：不同记忆类型职责明确
2. **性能优化**：使用合适的存储方案
3. **可扩展**：每层可以独立扩展
4. **符合 AI Agent 最佳实践**：借鉴了 LangChain 等框架的设计

### 消极影响

1. **复杂度**：需要管理多个存储系统
2. **数据同步**：需要维护数据一致性

### 缓解措施

- 提供统一的 Memory 接口
- 封装存储细节
- 实现数据同步机制

## 替代方案考虑

### 单一存储方案
- 将所有记忆存储在 PostgreSQL
- **问题**：性能不够，缺少语义检索能力

### 只使用 Vector DB
- 将所有记忆向量化存储
- **问题**：结构化数据查询不便，成本高

### 当前方案（混合存储）
- **优势**：兼顾性能和功能
- **劣势**：需要管理多个存储系统

## 实施阶段

### 第一阶段
- 实现短期记忆和工作记忆（Redis）

### 第二阶段
- 实现长期记忆（PostgreSQL + Weaviate）

### 第三阶段
- 实现语义记忆（Neo4j）

## 参考

- [MEMORY_SYSTEM.md](../MEMORY_SYSTEM.md)
- [ARCHITECTURE.md](../ARCHITECTURE.md)
