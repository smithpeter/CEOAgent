# US-001: 基础投资分析请求

> **文档编号**: US-001
> **版本**: 1.0
> **创建日期**: 2026-01-12
> **关联 PRD**: PRD_decision_analysis.md

---

## 用户故事

**作为** 一位中小企业 CEO，
**我希望** 能够提交投资决策问题并获得结构化的分析报告，
**以便** 在有限时间内做出更明智的投资决策。

---

## 场景描述

### 场景背景

张总是一家科技公司的 CEO，公司刚完成 Q3 财务结算。现在有一个扩张投资机会——开设新的区域分公司，需要投入 500-1000 万元。Q3 业绩有所下滑，现金流压力增大，张总需要快速评估这个投资机会是否值得把握。

### 使用流程

```
1. 张总打开 API 客户端（或集成的前端界面）
         │
         ▼
2. 输入决策问题和相关背景数据
   - 公司 Q1-Q3 财务数据
   - 投资机会描述
   - 市场环境信息
         │
         ▼
3. 提交请求，等待分析结果
         │
         ▼
4. 获得结构化分析报告
   - 态势分析
   - 风险评估（1-10 分）
   - 3 个可选投资方案
   - 最终推荐及理由
         │
         ▼
5. 基于报告做出决策
```

### 示例输入

```json
{
  "query": "我们公司 Q3 业绩下滑，但现在有一个扩张投资机会，需要 500-1000 万，应该如何决策？",
  "context": {
    "company_financials": {
      "Q1": { "revenue": 1200, "profit": 180, "cash_flow": 150 },
      "Q2": { "revenue": 1350, "profit": 210, "cash_flow": 180 },
      "Q3": { "revenue": 1100, "profit": 95, "cash_flow": 40 },
      "cash_reserve": 800
    },
    "investment_opportunity": {
      "type": "expansion",
      "description": "开设新的区域分公司",
      "budget_range": "500-1000万",
      "expected_return_period": "12-18个月"
    },
    "market_info": {
      "industry_growth": -5,
      "competitors": [
        { "name": "A公司", "growth": 12 },
        { "name": "B公司", "growth": 8 },
        { "name": "C公司", "growth": -3 }
      ],
      "labor_cost_increase": 15
    }
  }
}
```

### 示例输出

```json
{
  "success": true,
  "data": {
    "analysis_id": "ana_20260112_001",
    "query": "我们公司 Q3 业绩下滑...",
    "result": {
      "situation_analysis": {
        "summary": "公司 Q3 业绩明显下滑，收入同比下降 18%，利润下降 55%，现金流紧张。在行业增速放缓、人力成本上涨的环境下，扩张投资存在较高风险。",
        "key_findings": [
          "Q3 现金流仅 40 万，同比下降 78%",
          "现金储备 800 万，仅够支撑 8-10 个月运营",
          "竞争对手 A、B 公司逆势增长，市场份额可能被蚕食"
        ]
      },
      "risk_assessment": {
        "overall_score": 7,
        "risk_factors": [
          { "name": "现金流风险", "level": "high", "reason": "Q3 现金流大幅下滑，储备仅够 8-10 个月" },
          { "name": "市场风险", "level": "medium", "reason": "行业增速放缓，竞争加剧" },
          { "name": "执行风险", "level": "medium", "reason": "新分公司需要团队搭建，人力成本上涨" }
        ]
      },
      "recommendations": [
        {
          "title": "方案 A：暂缓投资，先稳固现金流",
          "investment_amount": "0",
          "expected_return": "N/A",
          "risk_level": "low",
          "timeline": "立即执行",
          "pros": ["保留现金储备", "降低经营风险", "有时间观察市场"],
          "cons": ["可能错过扩张窗口", "竞争对手可能抢占市场"],
          "action_steps": [
            "第 1-2 周：优化成本结构，削减非必要支出",
            "第 3-4 周：加速应收账款回收",
            "第 5-8 周：观察 Q4 业绩和市场变化"
          ]
        },
        {
          "title": "方案 B：小规模试点投资",
          "investment_amount": "300万",
          "expected_return": "10-15%",
          "risk_level": "medium",
          "timeline": "6 个月",
          "pros": ["风险可控", "验证市场需求", "保留较多现金"],
          "cons": ["规模效应不足", "可能无法完整验证模式"],
          "action_steps": [
            "第 1-2 周：选定试点城市，完成市场调研",
            "第 3-4 周：组建 5 人核心团队",
            "第 5-12 周：启动试点运营",
            "第 13-24 周：评估数据，决定是否扩大"
          ]
        },
        {
          "title": "方案 C：全面扩张投资",
          "investment_amount": "800万",
          "expected_return": "25-35%",
          "risk_level": "high",
          "timeline": "12-18 个月",
          "pros": ["抢占市场先机", "规模效应显著"],
          "cons": ["现金流压力大", "执行风险高", "如失败影响严重"],
          "action_steps": [
            "第 1-4 周：完成尽调和商务谈判",
            "第 5-8 周：完成团队组建（20 人）",
            "第 9-24 周：全面启动运营",
            "第 25-52 周：达成盈利目标"
          ]
        }
      ],
      "final_recommendation": {
        "choice": "方案 B：小规模试点投资",
        "reasoning": "考虑到 Q3 业绩下滑和现金流压力，全面扩张风险过高。但完全放弃扩张可能错失市场机会。建议采取小规模试点策略，用 300 万验证市场需求，同时保留 500 万现金缓冲。如果试点成功，再考虑扩大投资。"
      }
    }
  },
  "metadata": {
    "model": "claude-3-5-sonnet-20241022",
    "tokens_used": 2345,
    "execution_time_ms": 8500
  }
}
```

---

## 验收标准 (Acceptance Criteria)

### 功能验收

- [ ] **AC-1**: 当用户提交包含查询文本和上下文数据的请求时，系统应在 30 秒内返回结构化分析结果
- [ ] **AC-2**: 当响应返回时，必须包含完整的四部分内容：态势分析、风险评估、方案对比、最终建议
- [ ] **AC-3**: 当返回风险评分时，分数必须在 1-10 范围内，且附带具体的风险因素说明
- [ ] **AC-4**: 当返回投资方案时，至少包含 2 个可选方案，每个方案必须包含：名称、投资金额、预期回报、风险等级、优缺点、执行步骤
- [ ] **AC-5**: 当返回最终建议时，必须包含推荐的方案选择和具体的推荐理由

### 输入验证

- [ ] **AC-6**: 当查询文本为空时，应返回 400 错误，错误信息为 "query field is required"
- [ ] **AC-7**: 当查询文本超过 10000 字符时，应返回 400 错误，错误信息为 "query exceeds maximum length"
- [ ] **AC-8**: 当 context 字段格式不正确时，应返回 400 错误，并指明具体的格式问题

### 错误处理

- [ ] **AC-9**: 当 Claude API 超时（超过 60 秒）时，应返回 504 错误，错误码为 TIMEOUT
- [ ] **AC-10**: 当 Claude API 返回错误时，应返回 502 错误，错误码为 LLM_ERROR，并包含原始错误信息
- [ ] **AC-11**: 当响应解析失败时，应返回 500 错误，错误码为 PARSE_ERROR

---

## 优先级

| 维度 | 评估 | 说明 |
|------|------|------|
| **业务价值** | 高 | 核心功能，MVP 必须交付 |
| **紧急程度** | 高 | Phase 1 首要任务 |
| **综合优先级** | **P0** | 必须在 MVP 中实现 |

---

## 依赖

### 技术依赖

| 依赖项 | 类型 | 说明 |
|--------|------|------|
| Claude API | 外部服务 | 核心 LLM 能力 |
| FastAPI | 框架 | Web 服务框架 |
| Pydantic | 库 | 请求/响应验证 |

### 任务依赖

| 依赖任务 | 说明 |
|---------|------|
| Phase 0 场景验证 | Prompt 模板需要验证通过 |
| 项目基础架构 | 需要 FastAPI 项目结构就绪 |

---

## 备注

### 设计考虑

1. **输入灵活性**: 用户可以只提供 query 文本，context 为可选。系统应能基于自然语言描述进行分析。
2. **输出一致性**: 即使输入信息不完整，也应返回完整的输出结构，缺失部分用合理默认值或说明填充。
3. **幂等性**: 相同输入可能产生不同输出（LLM 特性），无需强制幂等。

### 后续迭代

- Phase 2: 支持多轮对话，追问细节
- Phase 2: 支持上传财务报表文件
- Phase 3: 支持历史决策对比

---

## 变更记录

| 版本 | 日期 | 修改内容 | 修改人 |
|------|------|---------|--------|
| 1.0 | 2026-01-12 | 初始版本 | PM |
